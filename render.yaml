services:
  # Backend API Service
  - type: web
    name: dairy-management-api
    env: node
    region: oregon
    plan: free
    buildCommand: cd backend && npm install && npm run build
    startCommand: cd backend && npm start
    healthCheckPath: /api/v1/health
    envVars:
      - key: NODE_ENV
        value: production
      - key: PORT
        value: 5000
      - key: DATABASE_HOST
        sync: false
      - key: DATABASE_PORT
        value: 3306
      - key: DATABASE_NAME
        sync: false
      - key: DATABASE_USER
        sync: false
      - key: DATABASE_PASSWORD
        sync: false
      - key: JWT_SECRET
        generateValue: true
      - key: JWT_EXPIRE
        value: 7d
      - key: EMAIL_HOST
        sync: false
      - key: EMAIL_PORT
        value: 587
      - key: EMAIL_USER
        sync: false
      - key: EMAIL_PASS
        sync: false
      - key: FRONTEND_URL
        sync: false
      - key: CRON_ENABLED
        value: true
      - key: CRON_LOW_STOCK_SCHEDULE
        value: "0 9 * * *"
      - key: CRON_EXPIRATION_SCHEDULE
        value: "0 9 * * *"
      - key: CRON_PAYMENT_SCHEDULE
        value: "0 10 * * *"
      - key: CRON_PRODUCTION_SCHEDULE
        value: "0 18 * * *"

  # Frontend Static Site (Optional - can also deploy to Netlify/Vercel)
  - type: web
    name: dairy-management-frontend
    env: static
    region: oregon
    plan: free
    buildCommand: npm install && npm run build
    staticPublishPath: ./dist
    headers:
      - path: /*
        name: X-Frame-Options
        value: DENY
      - path: /*
        name: X-Content-Type-Options
        value: nosniff
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

databases:
  # MySQL Database (Free tier not available - use external MySQL like PlanetScale or Railway)
  # - name: dairy-management-db
  #   plan: free
  #   databaseName: dairy_management
  #   user: dairy_user
